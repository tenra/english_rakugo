<%  @page_title = "confirm" %>

<h1><span style="color:#fff;">Confirm to Booking</span></h1>

<div class="event-back">
  <div class='row'>
    <div class='col-sm-offset-3 col-sm-6'>
      <div align="center">
        <% if @event.image? %>
              <%= image_tag @event.image.thumb.url, class: "ticket-image img-responsive" %>
        <% else %>
              <%= image_tag 'noimage.gif', width: 200, :class => "ticket-image img-responsive" %>
        <% end %>
      <div class="ticket-title">
        <%= @event.title %>
      </div>
      
      <div class="ticket-time">
          <% if @event.time || @event.end_time.present? %>
             <%= I18n.l @event.date, format: :full_date if @event.date.present? %>
             ,&nbsp;<%= @event.time.strftime("%H:%M") %>
             &nbsp;~&nbsp;
          <% if (@event.date.present? && @event.end_date.present?) && (@event.date != @event.end_date) %>
             <%= I18n.l @event.end_date, format: :full_date %>,
          <% end %>
             <%= @event.end_time.strftime("%H:%M") if @event.end_time.present? %>
          <% end %>
      </div>
      
      
        <div class="glyphicon glyphicon-flag"></div><%= t '.Venue' %>:<%= @event.address %>&nbsp;<br />
      <div class="well">
            <% if @event.price.blank? || @event.price == 0 %>
               <%= t '.Admission_free' %>
            <% else %>
               <%= number_to_currency(@event.price, :precision => 0, :local => 'jp') %>&nbsp;<%= t '.at_the_door' %>
            <% end %>
        
    <%= form_for(@event.bookings.build , url: event_bookings_path(@event)) do |f| %>
                  <%#= f.select :people, options_for_select((SupplierStockType.all.collect {|p| [ p[:name], p[:id] ] }), selected: @booking_people), class: "people_select_tag" %>
            <div class="inline-block"><%= f.select :people, options_for_select((1..5).to_a, selected: @booking_people), class: "people_select_tag" %><%= t '.people' %></div>
              <input type="hidden" name="tax_1" value="<%= @event.price %>">
            <div id="total"><%= number_to_currency(@event.price * (@booking_people || 1), :precision => 0, :local => 'jp') if @event.price.present? %></div>
               <%= "total" if @event.price.present? %>
               ※料金はサービス料と消費税を含んでいます。
      </div>
      
      <div style="margin:10px">
        <span id="booking_form-<%= @event.id %>">
            <% if @event.date.present? && @event.date <= Time.now %>
                <button type="button" class="btn btn-closed">closed</button>
            <% elsif @event.capacity == @event.booking_users.count %>
                <button type="button" class="btn btn-fullbook">full booking now</button>
            <% elsif @event.booking?(current_user) %>
                <%= link_to "check your booking", users_me_path, class: "btn btn-checkbooking" %>
            <% else %>
                <%= f.submit 'booking', class: "btn btn-booking" %>
            <% end %>
        </span>
      </div>
    <% end %>
      </div>
        <div class="back"><%= link_to "Back", :back %></div>
    </div>
  </div>
</div>

<script type="text/javascript">
      	$(document).ready(function(){
      		$("select#booking_people").change(function(){
      			$("select#booking_people option:selected").each(function(){
       				var tax_1= $('[name=tax_1]').val();
       				var booking = $('[name="booking[people]"]').val();
      				var result = tax_1 * booking ;
      				var old = $("#total").html();
              var new_price = old.replace(/\d+/g, Math.ceil(result));
      				$("#total").html(new_price);
      			});
      		});
      	});
</script>